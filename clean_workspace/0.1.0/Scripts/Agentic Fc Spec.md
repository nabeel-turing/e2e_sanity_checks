"""
Agentic Schema Generation Script Documentation
====================================

This script generates JSON schemas for Python packages using LLM-powered description rewriting.
Original schemas are generated by the script before the description rewriting using Gemini.
It analyzes function docstrings and generates standardized JSON schemas with improved descriptions.

Basic Usage
----------
```python
from Scripts.agentic_fcspec import generate_package_schema

# Basic usage with default settings for a single package
generate_package_schema(
    package_path="/path/to/package",
    output_folder_path="/path/to/output"
)

# Advanced usage with configuration
generate_package_schema(
    package_path="/path/to/package",
    output_folder_path="/path/to/output",
    config_path="/path/to/config.json"
)
```

Package Structure Requirements
----------------------------
1. The package must have an `__init__.py` file
2. The `__init__.py` must contain a `_function_map` dictionary that maps public function names to their fully qualified names
   Example:
   ```python
   _function_map = {
       "public_function_name": "module.submodule.actual_function_name"
   }
   ```

Configuration File Format
-----------------------
The configuration file should be a JSON file with the following structure:

```json
{
    "description_config": {
        "type": "concise",  // or "detailed" or "raw_docstring"
        "word_limit": 10    // only used when type is "concise"
    }
}
```

Configuration Options
-------------------
1. description_config.type:
   - "concise": Generates short, single-sentence descriptions (default)
   - "detailed": Generates more comprehensive descriptions
   - "raw_docstring": Uses original docstring descriptions without modification

2. description_config.word_limit:
   - Only applicable when type is "concise"
   - Controls maximum number of words in generated descriptions
   - Default: 10

Example Usage
-----------
```python
import os
import sys

# Define paths
FC_DIR = "/path/to/output/schemas"
APIS_DIR = "/path/to/apis"
CONTENT_DIR = "/path/to/content"

# Add content directory to Python path
sys.path.append(CONTENT_DIR)

# Import the schema generator
from Scripts.agentic_fcspec import generate_package_schema

# Create output directory
os.makedirs(FC_DIR, exist_ok=True)

# Change working directory to APIs directory
os.chdir(APIS_DIR)

# Load configuration
config_path = "/path/to/config.json"

# Process each package
for package_name in os.listdir(APIS_DIR):
    package_path = os.path.join(APIS_DIR, package_name)
    if os.path.isdir(package_path):
        generate_package_schema(
            package_path=package_path,
            output_folder_path=FC_DIR,
            config_path=config_path
        )

# Return to original directory
os.chdir(CONTENT_DIR)
```

Output Format
------------
The script generates a JSON file for each package with the following structure:
```json
[
    {
        "name": "function_name",
        "description": "Generated description",
        "parameters": {
            "type": "object",
            "properties": {
                "param_name": {
                    "type": "string|integer|number|boolean|array|object|null",
                    "description": "Parameter description",
                    "properties": {},  // For nested objects
                    "required": []     // For required nested properties
                }
            },
            "required": ["param1", "param2"]  // Required parameters
        }
    }
]
```

Notes
-----
1. The script uses Google's Gemini API for description rewriting
2. API key must be updated in the script (API_KEY variable)
3. Maximum number of concurrent workers can be adjusted (MAX_WORKERS variable)
4. The script handles nested object properties and required fields
5. Type mapping follows JSON Schema standards
6. Type handling for detailed and concise descriptions, along with the prompts, are defined in the AgenticConverter class in the agentic_fcspec.py file
7. Type handling for raw_docstring is defined in process_single_function function.

Error Handling
-------------
- Missing __init__.py: Script will report error and skip package
- Missing _function_map: Script will report error and skip package
- Invalid configuration: Script will use default settings
- API errors: Failed descriptions will be logged but won't stop processing

Dependencies
-----------
- google-genai
- docstring-parser
- concurrent.futures (standard library)
- threading (standard library)
- ast (standard library)
- json (standard library)
- os (standard library)
- sys (standard library)
- re (standard library)
""" 